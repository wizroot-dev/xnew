<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>sample02-analogstick</title>

    <script src="../pixi.min.js"></script>
    <script src="../../dist/xnew.js"></script>
</head>

<body style="height: 100vh; margin: 0;">
    
    <script>
        xnew(function() {
            const [width, height] = [800, 450];
            const canvas = xnew({ tag: 'canvas', width, height, style: 'width: 100%; height: 100%; vertical-align: bottom; object-fit: contain' });

            const pixi = {};
            pixi.renderer = PIXI.autoDetectRenderer({ view: canvas.element, width, height, resolution: window.devicePixelRatio ?? 1 });
            pixi.scene = new PIXI.Container();
            
            this.global.stick = xnew({ style: 'position: absolute; left: 0px; bottom: 0px;' }, xnex.AnalogStick, { size: 160 });
            this.global.button = xnew({ style: 'position: absolute; right: 20px; bottom: 20px;' }, xnex.CircleButton);
            this.global.button.on('buttondown', () => {
                console.log('down');
            })
      
            xnew(Box2d, { pixi });
            
            return {
                animate: () => {
                    pixi.renderer.render(pixi.scene)
                },
            };
        });

        function Box2d({ pixi }) {
            const container = pixi.scene.addChild(new PIXI.Container());
            container.x = pixi.renderer.screen.width / 2;
            container.y = pixi.renderer.screen.height / 2;

            const object = container.addChild(new PIXI.Container());
            const graphics = object.addChild(new PIXI.Graphics());
            graphics.beginFill(0xff2266);
            graphics.drawRect(-100, -100, 200, 200);
            graphics.endFill();

            let move = null;
            this.global.stick.on('analogstickstart analogstickmove', (event, ex) => {
                move = { x: ex.vector.x, y: ex.vector.y };
            });
            this.global.stick.on('analogstickend', (event, ex) => {
                move = { x: 0, y: 0 };
            });
            return {
                animate: () => {
                    object.rotation += 0.01;
                    if (move) {
                        object.x += move.x * 5;
                        object.y += move.y * 5;
                    }
                },
                finalize: () => {
                    pixi.container.removeChild(object);
                },
            };
        }
        

    </script>
</body>
</html>